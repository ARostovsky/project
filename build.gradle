apply plugin: 'groovy'

repositories {
    mavenCentral()
    maven {
        url "http://dl.bintray.com/jetbrains/teamcity-rest-client"
    }
}

dependencies {
    compile 'org.codehaus.groovy:groovy-all:2.4.8'
    compile 'org.apache.ant:ant:1.9.4'
    if (teamcity_rest_client_version == 'sources') {
        compile project('../teamcity-rest-client')
    } else {
        compile "org.jetbrains.teamcity:teamcity-rest-client:$teamcity_rest_client_version"
    }
}

task runScript (dependsOn: 'classes', type: JavaExec) {
    main = 'patchtest'
    classpath = sourceSets.main.runtimeClasspath

    def product = project.hasProperty('product') ? project.getProperty('product') : null  // %product%
    def platform = project.hasProperty('platform') ? project.getProperty('platform') : null   // %platform%
    def buildType = project.hasProperty('buildType') ? project.getProperty('buildType') : null  // %buildType%
    def timeout = project.hasProperty('timeout') ? project.getProperty('timeout') : '30'

    if (product && platform && buildType){
        args sprintf("'product':'$product','platform':'$platform','buildType':'$buildType','timeout':'$timeout'")
    } else {
        throw new GradleException("Some args: {product, platform, buildType} are undefined")
    }

}
