apply plugin: 'groovy'

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.codehaus.groovy:groovy-all:2.0.5'
    compile 'org.apache.ant:ant:1.9.4'
}

task runScript (dependsOn: 'classes', type: JavaExec) {
    main = 'patchtest'
    classpath = sourceSets.main.runtimeClasspath

    def product = project.hasProperty('product') ? project.getProperty('product') : null
    def platform = project.hasProperty('platform') ? project.getProperty('platform') : null   // %platform.ext%
    def buildType = project.hasProperty('buildType') ? project.getProperty('buildType') : null  // %buildType%
    def timeout = project.hasProperty('timeout') ? project.getProperty('timeout') : '30'

    if (product && platform && buildType){
        args sprintf("'product':'$product','platform':'$platform','buildType':'$buildType','timeout':'$timeout'")
    } else {
        throw new GradleException("Some args: {product, platform, buildType} are undefined")
    }

}
